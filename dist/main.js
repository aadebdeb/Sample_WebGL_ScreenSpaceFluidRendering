!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=function(){function e(e,t,r,n,i){this.program=function(e,t,r,n){var i=e.createProgram();if(e.attachShader(i,t),e.attachShader(i,r),n&&e.transformFeedbackVaryings(i,n,e.SEPARATE_ATTRIBS),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(i));return i}(e,t,r,i),this.uniforms=function(e,t,r){return r.reduce((function(r,n){return r.set(n,e.getUniformLocation(t,n)),r}),new Map)}(e,this.program,n)}return e.prototype.getUniform=function(e){var t=this.uniforms.get(e);if(void 0===t)throw new Error("no uniform "+e);return t},e}();function i(e,t,r){var n=e.createShader(r);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(n)+t);return n}function o(e,t,r){void 0===r&&(r=e.STATIC_DRAW);var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,r),e.bindBuffer(e.ARRAY_BUFFER,null),n}function a(e,t,r,n){var i=void 0===n?{}:n,o=i.internalFormat,a=void 0===o?e.RGBA:o,u=i.format,s=void 0===u?e.RGBA:u,f=i.type,c=void 0===f?e.UNSIGNED_BYTE:f,h=i.parameteri,l=void 0===h?[]:h,v=e.createTexture();return e.bindTexture(e.TEXTURE_2D,v),e.texImage2D(e.TEXTURE_2D,0,a,t,r,0,s,c,null),l.forEach((function(t){return e.texParameteri(e.TEXTURE_2D,t[0],t[1])})),e.bindTexture(e.TEXTURE_2D,null),v}function u(e,t,r,n){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,r),e.uniform1i(n,t)}var s,f,c=function(e,t,r){this.width=t,this.height=r,this.depthTexture=function(e,t,r){return a(e,t,r,{internalFormat:e.DEPTH_COMPONENT32F,format:e.DEPTH_COMPONENT,type:e.FLOAT,parameteri:[[e.TEXTURE_MAG_FILTER,e.NEAREST],[e.TEXTURE_MIN_FILTER,e.NEAREST],[e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE],[e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE]]})}(e,this.width,this.height),this.framebuffer=function(e,t){var r=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,t,0),e.drawBuffers([e.NONE]),e.bindFramebuffer(e.FRAMEBUFFER,null),r}(e,this.depthTexture)},h=function(){function e(e,t,r){this.x=e,this.y=t,this.z=r}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0,0)},enumerable:!0,configurable:!0}),e.prototype.sqMag=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.mag=function(){return Math.sqrt(this.sqMag())},e.prototype.norm=function(){var e=this.mag();return this.mul(1/e)},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.mul=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.mulV=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},e.prototype.div=function(e){return this.mul(1/e)},e.prototype.divV=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.toArray=function(){return[this.x,this.y,this.z]},e.add=function(t,r){return new e(t.x+r.x,t.y+r.y,t.z+r.z)},e.sub=function(t,r){return new e(t.x-r.x,t.y-r.y,t.z-r.z)},e.mul=function(t,r){return new e(t.x*r,t.y*r,t.z*r)},e.mulV=function(t,r){return new e(t.x*r.x,t.y*r.y,t.z*r.z)},e.div=function(t,r){return e.mul(t,1/r)},e.divV=function(t,r){return new e(t.x/r.x,t.y/r.y,t.z/r.z)},e.inverse=function(t){return e.mul(t,-1)},e.norm=function(t){var r=t.mag();return e.div(t,r)},e.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.cross=function(t,r){return new e(t.y*r.z-t.z*r.y,t.z*r.x-t.x*r.z,t.x*r.y-t.y*r.x)},e.dist=function(t,r){return e.sub(t,r).mag()},e}(),l="#version 300 es\n\nprecision highp float;\n\nlayout (location = 0) in vec3 i_position;\nlayout (location = 1) in float i_life;\n\nout vec2 v_uv;\nout vec3 v_worldPos;\n\nuniform float u_size;\nuniform vec3 u_cameraPos;\nuniform vec3 u_cameraUp;\nuniform mat4 u_vpMatrix;\n\nconst vec3[4] POSITIONS = vec3[](\n  vec3(-1.0, -1.0, 0.0),\n  vec3(1.0, -1.0, 0.0),\n  vec3(-1.0, 1.0, 0.0),\n  vec3(1.0, 1.0, 0.0)\n);\n\nconst vec2[4] UVS = vec2[](\n  vec2(0.0, 0.0),\n  vec2(1.0, 0.0),\n  vec2(0.0, 1.0),\n  vec2(1.0, 1.0)\n);\n\nconst int[6] INDICES = int[](\n  0, 1, 2,\n  3, 2, 1\n);\n\nmat3 lookTo(vec3 front, vec3 up) {\n  vec3 z = -normalize(front);\n  vec3 x = cross(up, z);\n  vec3 y = cross(z, x);\n\n  return mat3(\n    x.x, x.y, x.z,\n    y.x, y.y, y.z,\n    z.x, z.y, z.z\n  );\n}\n\nvoid main(void) {\n  int index = INDICES[gl_VertexID];\n  float size = u_size * smoothstep(0.0, 0.2, (0.5 - abs(i_life - 0.5)) * 2.0);\n  vec3 worldPos = lookTo(i_position - u_cameraPos, u_cameraUp) * size * POSITIONS[index] + i_position;\n  gl_Position = u_vpMatrix * vec4(worldPos, 1.0);\n  v_uv = UVS[index];\n  v_worldPos = i_position;\n}",v="#version 300 es\n\nprecision highp float;\n\nin vec2 v_uv;\nin vec3 v_worldPos;\n\nuniform float u_size;\nuniform mat4 u_vpMatrix;\n\nvoid main(void) {\n  vec2 st = v_uv * 2.0 - 1.0;\n  if (length(st) > 1.0) discard;\n\n  vec3 objPos = u_size * vec3(st.x, st.y, sqrt(max(1.0 - st.x * st.x - st.y * st.y, 0.00001)));\n  vec4 clipPos = u_vpMatrix * vec4(v_worldPos + objPos, 1.0);\n  gl_FragDepth = clamp(clipPos.z / clipPos.w * 0.5 + 0.5, 0.0, 1.0);\n}",d="#version 300 es\n\nprecision highp float;\n\nlayout (location = 0) in vec3 i_position;\nlayout (location = 1) in vec3 i_velocity;\nlayout (location = 2) in float i_life;\n\nout vec3 o_position;\nout vec3 o_velocity;\nout float o_life;\n\nuniform float u_deltaSecs;\nuniform float u_elapsedSecs;\nuniform float u_lifeSecs;\nuniform float u_initialPosRadius;\nuniform float u_forceScale;\n\nvec3 random3(float x) {\n    return fract(sin(x * vec3(12.9898, 51.431, 29.964)) * vec3(43758.5453, 71932.1354, 39215.4221));\n}\n\nvec3 randomInSphere(float x) {\n    vec3 r = random3(x);\n    float s = sqrt(1.0 - r.x * r.x);\n    float a = 6.28318530718 * r.y;\n    float d = pow(r.z, 0.333);\n    return vec3(d * s * cos(a), d * s * sin(a), d * r.x);\n}\n\nfloat random(vec4 x){\n    return fract(sin(dot(x,vec4(12.9898, 78.233, 39.425, 27.196))) * 43758.5453);\n}\n\nfloat valuenoise(vec4 x) {\n  vec4 i = floor(x);\n  vec4 f = fract(x);\n\n  vec4 u = f * f * (3.0 - 2.0 * f);\n\n  return mix(\n    mix(\n      mix(\n          mix(random(i + vec4(0.0, 0.0, 0.0, 0.0)), random(i + vec4(1.0, 0.0, 0.0, 0.0)), u.x),\n          mix(random(i + vec4(0.0, 1.0, 0.0, 0.0)), random(i + vec4(1.0, 1.0, 0.0, 0.0)), u.x),\n          u.y\n      ),\n      mix(\n          mix(random(i + vec4(0.0, 0.0, 1.0, 0.0)), random(i + vec4(1.0, 0.0, 1.0, 0.0)), u.x),\n          mix(random(i + vec4(0.0, 1.0, 1.0, 0.0)), random(i + vec4(1.0, 1.0, 1.0, 0.0)), u.x),\n          u.y\n      ),\n      u.z\n    ),\n    mix(\n      mix(\n          mix(random(i + vec4(0.0, 0.0, 0.0, 1.0)), random(i + vec4(1.0, 0.0, 0.0, 1.0)), u.x),\n          mix(random(i + vec4(0.0, 1.0, 0.0, 1.0)), random(i + vec4(1.0, 1.0, 0.0, 1.0)), u.x),\n          u.y\n      ),\n      mix(\n          mix(random(i + vec4(0.0, 0.0, 1.0, 1.0)), random(i + vec4(1.0, 0.0, 1.0, 1.0)), u.x),\n          mix(random(i + vec4(0.0, 1.0, 1.0, 1.0)), random(i + vec4(1.0, 1.0, 1.0, 1.0)), u.x),\n          u.y\n      ),\n      u.z\n    ),\n    u.w\n  );\n}\n\nvec3 valuenoise3(vec4 x) {\n  return vec3(\n    valuenoise(x),\n    valuenoise(x + vec4(123.11, 324.19, 632.32, 124.24)),\n    valuenoise(x + vec4(734.63, 239.92, 431.94, 1043.18))\n  );\n}\n\n#define EPSILON 0.01\n\n#define GRAVITY_FORCE vec3(0.0, -9.8, 0.0)\n\nvoid main(void) {\n\n  vec3 dx = vec3(EPSILON, 0.0, 0.0);\n  vec3 dy = vec3(0.0, EPSILON, 0.0);\n  vec3 dz = vec3(0.0, 0.0, EPSILON);\n\n  vec3 p = 0.2 * i_position;\n  float t = 0.2 * u_elapsedSecs;\n\n  vec3 dpdx0 = valuenoise3(vec4(p - dx, t));\n  vec3 dpdx1 = valuenoise3(vec4(p + dx, t));\n  vec3 dpdy0 = valuenoise3(vec4(p - dy, t));\n  vec3 dpdy1 = valuenoise3(vec4(p + dy, t));\n  vec3 dpdz0 = valuenoise3(vec4(p - dz, t));\n  vec3 dpdz1 = valuenoise3(vec4(p + dz, t));\n\n  float x = dpdy1.z - dpdy0.z + dpdz1.y - dpdz0.y;\n  float y = dpdz1.x - dpdz0.x + dpdx1.z - dpdx0.z;\n  float z = dpdx1.y - dpdx0.y + dpdy1.x - dpdy0.x;\n\n  float life = i_life;\n  vec3 position = i_position;\n  vec3 velocity = i_velocity;\n  if (life > 1.0) {\n    life -= 1.0;\n    position = u_initialPosRadius * randomInSphere(float(gl_VertexID));\n    velocity = vec3(0.0);\n  }\n\n  vec3 force = vec3(x, y, z) / EPSILON * 2.0;\n  velocity += u_deltaSecs * u_forceScale * force;\n\n  o_position = position + u_deltaSecs * velocity;\n  o_velocity = velocity;\n  o_life = life + u_deltaSecs / u_lifeSecs;\n}",p="#version 300 es\n\nvoid main(void) {}";!function(e){e.DELTA_SECS="u_deltaSecs",e.EPALSED_SECS="u_elapsedSecs",e.LIFE_SECS="u_lifeSecs",e.INITIAL_POS_RADIUS="u_initialPosRadius",e.FORCE_SCALE="u_forceScale"}(s||(s={})),function(e){e.SIZE="u_size",e.CAMERA_POS="u_cameraPos",e.CAMERA_UP="u_cameraUp",e.VP_MATRIX="u_vpMatrix"}(f||(f={}));var m=function(){function e(e,t){var r=void 0===t?{}:t,a=r.particleNum,u=void 0===a?1e4:a,c=r.particleSize,h=void 0===c?1:c,m=r.lifeSecs,_=void 0===m?30:m,x=r.initialPosRadius,g=void 0===x?1:x,y=r.forceScale,b=void 0===y?1:y;this.particleNum=u,this.particleSize=h,this.lifeSecs=_,this.initialPosRadius=g,this.forceScale=b,this.posVbo=o(e,function(e,t){for(var r=new Float32Array(3*e),n=0;n<e;n+=3){var i=2*Math.random()-1,o=Math.random()*Math.PI*2,a=Math.pow(Math.random(),.333);r[n]=t*a*Math.sqrt(1-i*i)*Math.cos(o),r[n+1]=t*a*Math.sqrt(1-i*i)*Math.sin(o),r[n+2]=t*a*i}return r}(u,g),e.DYNAMIC_COPY),this.posVboW=o(e,new Float32Array(3*u),e.DYNAMIC_COPY),this.velVbo=o(e,new Float32Array(3*u),e.DYNAMIC_COPY),this.velVboW=o(e,new Float32Array(3*u),e.DYNAMIC_COPY),this.lifeVbo=o(e,function(e){for(var t=new Float32Array(e),r=0;r<e;r+=1)t[r]=Math.random();return t}(u),e.DYNAMIC_COPY),this.lifeVboW=o(e,new Float32Array(u),e.DYNAMIC_COPY),this.transformFeedback=e.createTransformFeedback(),this.updateProgram=new n(e,i(e,d,e.VERTEX_SHADER),i(e,p,e.FRAGMENT_SHADER),Object.values(s),["o_position","o_velocity","o_life"]),this.renderProgram=new n(e,i(e,l,e.VERTEX_SHADER),i(e,v,e.FRAGMENT_SHADER),Object.values(f))}return e.prototype.update=function(e,t,r){var n,i,o;e.useProgram(this.updateProgram.program),e.uniform1f(this.updateProgram.getUniform(s.DELTA_SECS),t),e.uniform1f(this.updateProgram.getUniform(s.EPALSED_SECS),r),e.uniform1f(this.updateProgram.getUniform(s.LIFE_SECS),this.lifeSecs),e.uniform1f(this.updateProgram.getUniform(s.INITIAL_POS_RADIUS),this.initialPosRadius),e.uniform1f(this.updateProgram.getUniform(s.FORCE_SCALE),this.forceScale),e.bindBuffer(e.ARRAY_BUFFER,this.posVbo),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.velVbo),e.enableVertexAttribArray(1),e.vertexAttribPointer(1,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.lifeVbo),e.enableVertexAttribArray(2),e.vertexAttribPointer(2,1,e.FLOAT,!1,0,0),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.transformFeedback),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,this.posVboW),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,1,this.velVboW),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,2,this.lifeVboW),e.enable(e.RASTERIZER_DISCARD),e.beginTransformFeedback(e.POINTS),e.drawArrays(e.POINTS,0,this.particleNum),e.endTransformFeedback(),e.disable(e.RASTERIZER_DISCARD),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,null),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,1,null),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,2,null),n=[this.posVboW,this.posVbo],this.posVbo=n[0],this.posVboW=n[1],i=[this.velVboW,this.velVbo],this.velVbo=i[0],this.velVboW=i[1],o=[this.lifeVboW,this.lifeVbo],this.lifeVbo=o[0],this.lifeVboW=o[1]},e.prototype.render=function(e,t){e.useProgram(this.renderProgram.program),e.uniform1f(this.renderProgram.getUniform(f.SIZE),this.particleSize),e.uniform3fv(this.renderProgram.getUniform(f.CAMERA_POS),t.position.toArray()),e.uniform3fv(this.renderProgram.getUniform(f.CAMERA_UP),new h(0,1,0).toArray()),e.uniformMatrix4fv(this.renderProgram.getUniform(f.VP_MATRIX),!1,t.vpMatrix.elements),e.bindBuffer(e.ARRAY_BUFFER,this.posVbo),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0),e.vertexAttribDivisor(0,1),e.bindBuffer(e.ARRAY_BUFFER,this.lifeVbo),e.enableVertexAttribArray(1),e.vertexAttribPointer(1,1,e.FLOAT,!1,0,0),e.vertexAttribDivisor(1,1),e.drawArraysInstanced(e.TRIANGLES,0,6,this.particleNum),e.vertexAttribDivisor(0,0),e.vertexAttribDivisor(1,0)},e}(),_=function(){function e(e,t){this.elements=e,this._determinant=null,this._invMatrix=null,this._normalMatrix=null,void 0!==t&&(this._invMatrix=t,this._invMatrix._invMatrix=this)}return e.identity=function(){return new e(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),new e(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])))},e.translation=function(t,r,n){return new e(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,r,n,1]),new e(new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-r,-n,1])))},e.translationV=function(t){return e.translation(t.x,t.y,t.z)},e.scaling=function(t,r,n){return new e(new Float32Array([t,0,0,0,0,r,0,0,0,0,n,0,0,0,0,1]),new e(new Float32Array([1/t,0,0,0,0,1/r,0,0,0,0,1/n,0,0,0,0,1])))},e.scalingV=function(t){return e.scaling(t.x,t.y,t.z)},e.rotationX=function(t){var r=Math.cos(t),n=Math.sin(t),i=Math.cos(-t),o=Math.sin(-t);return new e(new Float32Array([1,0,0,0,0,r,n,0,0,-n,r,0,0,0,0,1]),new e(new Float32Array([1,0,0,0,0,i,o,0,0,-o,i,0,0,0,0,1])))},e.rotationY=function(t){var r=Math.cos(t),n=Math.sin(t),i=Math.cos(-t),o=Math.sin(-t);return new e(new Float32Array([r,0,-n,0,0,1,0,0,n,0,r,0,0,0,0,1]),new e(new Float32Array([i,0,-o,0,0,1,0,0,o,0,i,0,0,0,0,1])))},e.rotationZ=function(t){var r=Math.cos(t),n=Math.sin(t),i=Math.cos(-t),o=Math.sin(-t);return new e(new Float32Array([r,n,0,0,-n,r,0,0,0,0,1,0,0,0,0,1]),new e(new Float32Array([i,o,0,0,-o,i,0,0,0,0,1,0,0,0,0,1])))},e.rotationXYZ=function(t){var r=Math.cos(t.x),n=Math.sin(t.x),i=Math.cos(t.y),o=Math.sin(t.y),a=Math.cos(t.z),u=Math.sin(t.z),s=Math.cos(-t.x),f=Math.sin(-t.x),c=Math.cos(-t.y),h=Math.sin(-t.y),l=Math.cos(-t.z),v=Math.sin(-t.z);return new e(new Float32Array([i*a,i*u,-o,0,n*o*a-r*u,n*o*u+r*a,n*i,0,r*o*a+n*u,r*o*u-n*a,r*i,0,0,0,0,1]),new e(new Float32Array([c*l,c*v,-h,0,f*h*l-s*v,f*h*v+s*l,f*c,0,s*h*l+f*v,s*h*v-f*l,s*c,0,0,0,0,1])))},e.transpose=function(t){var r=t.elements;return new e(new Float32Array([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]]))},e.inverse=function(e){return e.getInvMatrix()},e.mul=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return n.reduce((function(t,r){return e._mul(t,r)}),e._mul(t,r))},e._mul=function(t,r){var n=t.elements,i=r.elements;return new e(new Float32Array([n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],n[0]*i[1]+n[1]*i[5]+n[2]*i[9]+n[3]*i[13],n[0]*i[2]+n[1]*i[6]+n[2]*i[10]+n[3]*i[14],n[0]*i[3]+n[1]*i[7]+n[2]*i[11]+n[3]*i[15],n[4]*i[0]+n[5]*i[4]+n[6]*i[8]+n[7]*i[12],n[4]*i[1]+n[5]*i[5]+n[6]*i[9]+n[7]*i[13],n[4]*i[2]+n[5]*i[6]+n[6]*i[10]+n[7]*i[14],n[4]*i[3]+n[5]*i[7]+n[6]*i[11]+n[7]*i[15],n[8]*i[0]+n[9]*i[4]+n[10]*i[8]+n[11]*i[12],n[8]*i[1]+n[9]*i[5]+n[10]*i[9]+n[11]*i[13],n[8]*i[2]+n[9]*i[6]+n[10]*i[10]+n[11]*i[14],n[8]*i[3]+n[9]*i[7]+n[10]*i[11]+n[11]*i[15],n[12]*i[0]+n[13]*i[4]+n[14]*i[8]+n[15]*i[12],n[12]*i[1]+n[13]*i[5]+n[14]*i[9]+n[15]*i[13],n[12]*i[2]+n[13]*i[6]+n[14]*i[10]+n[15]*i[14],n[12]*i[3]+n[13]*i[7]+n[14]*i[11]+n[15]*i[15]]))},e.basis=function(t,r,n){return new e(new Float32Array([t.x,t.y,t.z,0,r.x,r.y,r.z,0,n.x,n.y,n.z,0,0,0,0,1]))},e.perspective=function(t,r,n,i){var o=r*Math.PI/180,a=n*Math.tan(.5*o),u=i-n;return new e(new Float32Array([n/(t*a),0,0,0,0,n/a,0,0,0,0,-(i+n)/u,-1,0,0,-2*i*n/u,0]))},e.orthographic=function(t,r,n,i){var o=1/(i-n);return new e(new Float32Array([2/t,0,0,0,0,2/r,0,0,0,0,-2*o,0,0,0,-(i+n)*o,1]))},e.prototype.determinant=function(){if(null===this._determinant){var e=this.elements;this._determinant=e[0]*(e[5]*e[10]*e[15]+e[9]*e[14]*e[7]+e[13]*e[6]*e[11]-e[13]*e[10]*e[7]-e[9]*e[6]*e[15]-e[5]*e[14]*e[11])-e[4]*(e[1]*e[10]*e[15]+e[9]*e[14]*e[3]+e[13]*e[2]*e[11]-e[13]*e[10]*e[3]-e[9]*e[2]*e[15]-e[1]*e[14]*e[11])+e[8]*(e[1]*e[6]*e[15]+e[5]*e[14]*e[3]+e[13]*e[2]*e[7]-e[13]*e[6]*e[3]-e[5]*e[2]*e[15]-e[1]*e[14]*e[7])-e[8]*(e[1]*e[6]*e[11]+e[5]*e[10]*e[3]+e[9]*e[2]*e[7]-e[9]*e[6]*e[3]-e[5]*e[2]*e[11]-e[1]*e[10]*e[7])}return this._determinant},e.prototype.getInvMatrix=function(){if(null===this._invMatrix){var t=this.determinant();if(Math.abs(t)<=0)throw new Error("not invertiable");var r=1/t,n=this.elements;this._invMatrix=new e(new Float32Array([(n[5]*n[10]*n[15]+n[9]*n[14]*n[7]+n[13]*n[6]*n[11]-n[13]*n[10]*n[7]-n[9]*n[6]*n[15]-n[5]*n[14]*n[11])*r,-(n[1]*n[10]*n[15]+n[9]*n[14]*n[3]+n[13]*n[2]*n[11]-n[13]*n[10]*n[3]-n[9]*n[2]*n[15]-n[1]*n[14]*n[11])*r,(n[1]*n[6]*n[15]+n[5]*n[14]*n[3]+n[13]*n[2]*n[7]-n[13]*n[6]*n[3]-n[5]*n[2]*n[15]-n[1]*n[14]*n[7])*r,-(n[1]*n[6]*n[11]+n[5]*n[10]*n[3]+n[9]*n[2]*n[7]-n[9]*n[6]*n[3]-n[5]*n[2]*n[11]-n[1]*n[10]*n[7])*r,-(n[4]*n[10]*n[15]+n[8]*n[14]*n[7]+n[12]*n[6]*n[11]-n[12]*n[10]*n[7]-n[8]*n[6]*n[15]-n[4]*n[14]*n[11])*r,(n[0]*n[10]*n[15]+n[8]*n[14]*n[3]+n[12]*n[2]*n[11]-n[12]*n[10]*n[3]-n[8]*n[2]*n[15]-n[0]*n[14]*n[11])*r,-(n[0]*n[6]*n[15]+n[4]*n[14]*n[3]+n[12]*n[2]*n[7]-n[12]*n[6]*n[3]-n[4]*n[2]*n[15]-n[0]*n[14]*n[7])*r,(n[0]*n[6]*n[11]+n[4]*n[10]*n[3]+n[8]*n[2]*n[7]-n[8]*n[6]*n[3]-n[4]*n[2]*n[11]-n[0]*n[10]*n[7])*r,(n[4]*n[9]*n[15]+n[8]*n[13]*n[7]+n[12]*n[5]*n[11]-n[12]*n[9]*n[7]-n[8]*n[5]*n[15]-n[4]*n[13]*n[11])*r,-(n[0]*n[9]*n[15]+n[8]*n[13]*n[3]+n[12]*n[1]*n[11]-n[12]*n[9]*n[3]-n[8]*n[1]*n[15]-n[0]*n[13]*n[11])*r,(n[0]*n[5]*n[15]+n[4]*n[13]*n[3]+n[12]*n[1]*n[7]-n[12]*n[5]*n[3]-n[4]*n[1]*n[15]-n[0]*n[13]*n[7])*r,-(n[0]*n[5]*n[11]+n[4]*n[9]*n[3]+n[8]*n[1]*n[7]-n[8]*n[5]*n[3]-n[4]*n[1]*n[11]-n[0]*n[9]*n[7])*r,-(n[4]*n[9]*n[14]+n[8]*n[13]*n[6]+n[12]*n[5]*n[10]-n[12]*n[9]*n[6]-n[8]*n[5]*n[14]-n[4]*n[13]*n[10])*r,(n[0]*n[9]*n[14]+n[8]*n[13]*n[2]+n[12]*n[1]*n[10]-n[12]*n[9]*n[2]-n[8]*n[1]*n[14]-n[0]*n[13]*n[10])*r,-(n[0]*n[5]*n[14]+n[4]*n[13]*n[2]+n[12]*n[1]*n[6]-n[12]*n[5]*n[2]-n[4]*n[1]*n[14]-n[0]*n[13]*n[6])*r,(n[0]*n[5]*n[10]+n[4]*n[9]*n[2]+n[8]*n[1]*n[6]-n[8]*n[5]*n[2]-n[4]*n[1]*n[10]-n[0]*n[9]*n[6])*r]),this)}return this._invMatrix},e.prototype.getNormalMatrix=function(){return null===this._normalMatrix&&(this._normalMatrix=e.transpose(this.getInvMatrix())),this._normalMatrix},e.lookAt=function(t,r,n){var i=h.sub(r,t).norm(),o=h.mul(i,-1),a=h.cross(n,o),u=h.cross(o,a);return new e(new Float32Array([a.x,a.y,a.z,0,u.x,u.y,u.z,0,o.x,o.y,o.z,0,t.x,t.y,t.z,1]))},e}(),x=function(){function e(e){var t=void 0===e?{}:e,r=t.aspect,n=void 0===r?1.3:r,i=t.vfov,o=void 0===i?60:i,a=t.near,u=void 0===a?.01:a,s=t.far,f=void 0===s?1e3:s,c=t.origin,l=void 0===c?new h(0,0,10):c,v=t.target,d=void 0===v?h.zero:v;this._aspect=n,this._vfov=o,this._near=u,this._far=f,this._position=l,this._matrix=_.lookAt(l,d,new h(0,1,0)),this._viewMatrix=this._matrix.getInvMatrix(),this._projMatrix=_.perspective(this._aspect,this._vfov,this._near,this._far),this._vpMatrix=_.mul(this._viewMatrix,this._projMatrix)}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projMatrix",{get:function(){return this._projMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vpMatrix",{get:function(){return this._vpMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},set:function(e){this._aspect=e,this._projMatrix=_.perspective(this._aspect,this._vfov,this._near,this._far),this._vpMatrix=_.mul(this._viewMatrix,this._projMatrix)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vfov",{get:function(){return this._vfov},set:function(e){this._vfov=e,this._projMatrix=_.perspective(this._aspect,this._vfov,this._near,this._far),this._vpMatrix=_.mul(this._viewMatrix,this._projMatrix)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},enumerable:!0,configurable:!0}),e.prototype.lookAt=function(e,t){this._position=e.clone(),this._matrix=_.lookAt(e,t,new h(0,1,0)),this._viewMatrix=this._matrix.getInvMatrix(),this._vpMatrix=_.mul(this._viewMatrix,this._projMatrix)},e}(),g="#version 300 es\n\nout vec2 v_uv;\n\nconst vec2[4] POSITIONS = vec2[](\n  vec2(-1.0, -1.0),\n  vec2(1.0, -1.0),\n  vec2(-1.0, 1.0),\n  vec2(1.0, 1.0)\n);\n\nconst int[6] INDICES = int[](\n  0, 1, 2,\n  3, 2, 1\n);\n\nvoid main(void) {\n  vec2 pos = POSITIONS[INDICES[gl_VertexID]];\n  v_uv = pos * 0.5 + 0.5;\n  gl_Position = vec4(pos, 0.0, 1.0);\n}",y="#version 300 es\n\nprecision highp float;\n\nin vec2 v_uv;\nout vec4 o_color;\n\nuniform sampler2D u_srcTexture;\n\nvoid main(void) {\n    o_color = vec4(texture(u_srcTexture, v_uv).rgb, 1.0);\n}",b=function(){function e(e){var t=i(e,g,e.VERTEX_SHADER),r=i(e,y,e.FRAGMENT_SHADER);this.program=new n(e,t,r,["u_srcTexture"])}return e.prototype.apply=function(e,t,r,n){e.bindFramebuffer(e.FRAMEBUFFER,r.framebuffer),e.viewport(0,0,r.width,r.height),e.useProgram(this.program.program),u(e,0,t.texture,this.program.getUniform("u_srcTexture")),e.drawArrays(e.TRIANGLES,0,6)},e}();var E=function(){function e(e,t,r){this._width=t,this._height=r,this.createFramebuffer(e)}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this._framebuffer},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,r){this._width=t,this._height=r,this.createFramebuffer(e)},e.prototype.createFramebuffer=function(e){this._texture=function(e,t,r){return a(e,t,r,{internalFormat:e.RGBA32F,format:e.RGBA,type:e.FLOAT,parameteri:[[e.TEXTURE_MAG_FILTER,e.NEAREST],[e.TEXTURE_MIN_FILTER,e.NEAREST],[e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE],[e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE]]})}(e,this._width,this._height),this._framebuffer=function(e,t){var r=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.bindFramebuffer(e.FRAMEBUFFER,null),r}(e,this.texture)},e}(),A=function(){function e(e,t,r){this._width=t,this._height=r,this.createFramebuffer(e)}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.readableRenderTarget.texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.writableRenderTarget.framebuffer},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,r){this._width=t,this._height=r,this.createFramebuffer(e)},e.prototype.swap=function(){var e;e=[this.writableRenderTarget,this.readableRenderTarget],this.readableRenderTarget=e[0],this.writableRenderTarget=e[1]},e.prototype.createFramebuffer=function(e){this.readableRenderTarget=new E(e,this._width,this._height),this.writableRenderTarget=new E(e,this._width,this._height)},e}(),T="#version 300 es\n\nprecision highp float;\n\nout vec4 o_color;\n\nuniform sampler2D u_srcTexture;\nuniform bool u_horizontal;\nuniform float u_near;\nuniform float u_far;\nuniform float u_blurDepthRange;\n\nconst float[5] weights = float[](0.2270270, 0.1945945, 0.1216216, 0.0540540, 0.0162162);\n\nfloat toLinearDepth(float depth, float near, float far) {\n    float nz = near * depth;\n    return -nz / (far * (depth - 1.0) - nz);\n}\n\nfloat toViewZ(float depth, float near, float far) {\n    return near + (far - near) * toLinearDepth(depth, near, far);\n}\n\nivec2 clampCoord(ivec2 coord, ivec2 texSize) {\n    return max(min(coord, texSize - 1), 0);\n}\n\nvoid main(void) {\n    ivec2 coord = ivec2(gl_FragCoord.xy);\n    ivec2 texSize = textureSize(u_srcTexture, 0);\n\n    vec3 centerD = texelFetch(u_srcTexture, coord, 0).rgb;\n    float centerZ = toViewZ(centerD.r, u_near, u_far);\n    vec3 sum = weights[0] * centerD;\n    for (int i = 1; i < 5; i++) {\n        ivec2 offset = u_horizontal ? ivec2(i, 0) : ivec2(0, i);\n        {\n            vec3 d = texelFetch(u_srcTexture, clampCoord(coord + offset, texSize), 0).rgb;\n            float z = toViewZ(d.r, u_near, u_far);\n            sum += weights[i] * mix(d, centerD, smoothstep(0.0, u_blurDepthRange, abs(centerZ - z)));\n        }\n        {\n            vec3 d = texelFetch(u_srcTexture, clampCoord(coord - offset, texSize), 0).rgb;\n            float z = toViewZ(d.r, u_near, u_far);\n            sum += weights[i] * mix(d, centerD, smoothstep(0.0, u_blurDepthRange, abs(centerZ - z)));\n        }\n    }\n    o_color = vec4(sum, 1.0);\n}",R=function(){function e(e,t,r){var o=i(e,g,e.VERTEX_SHADER),a=i(e,T,e.FRAGMENT_SHADER);this.program=new n(e,o,a,["u_srcTexture","u_horizontal","u_near","u_far","u_blurDepthRange"]),this.renderTarget=new A(e,t,r),this.copyFilter=new b(e)}return e.prototype.apply=function(e,t,r,n,i,o){this.copyFilter.apply(e,t,this.renderTarget,o),this.renderTarget.swap(),e.viewport(0,0,this.renderTarget.width,this.renderTarget.height);for(var a=0;a<1;a++)e.bindFramebuffer(e.FRAMEBUFFER,this.renderTarget.framebuffer),e.useProgram(this.program.program),u(e,0,this.renderTarget.texture,this.program.getUniform("u_srcTexture")),e.uniform1i(this.program.getUniform("u_horizontal"),1),e.drawArrays(e.TRIANGLES,0,6),this.renderTarget.swap(),e.bindFramebuffer(e.FRAMEBUFFER,this.renderTarget.framebuffer),e.useProgram(this.program.program),u(e,0,this.renderTarget.texture,this.program.getUniform("u_srcTexture")),e.uniform1i(this.program.getUniform("u_horizontal"),0),e.uniform1f(this.program.getUniform("u_near"),r),e.uniform1f(this.program.getUniform("u_far"),r),e.uniform1f(this.program.getUniform("u_far"),n),e.uniform1f(this.program.getUniform("u_blurDepthRange"),i),e.drawArrays(e.TRIANGLES,0,6),this.renderTarget.swap();return this.renderTarget.texture},e}(),w=function(){function e(e,t,r){this.texture=e,this.width=t,this.height=r}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,r){},e}(),F=document.createElement("canvas");F.width=innerWidth,F.height=innerHeight,document.body.appendChild(F);var M=F.getContext("webgl2");M.getExtension("EXT_color_buffer_float"),M.clearColor(0,0,0,1);var P,S=new c(M,F.width,F.height),z=new h(30,0,50),D=new x({aspect:F.width/F.height,vfov:60,near:.1,far:200,origin:z,target:new h(0,0,0)}),I=new m(M,{particleNum:3e4,particleSize:.5,lifeSecs:5,initialPosRadius:3,forceScale:2.5});!function(e){e.DEPTH_TEXTURE="u_depthTexture",e.INV_VP_MATRIX="u_invVpMatrix",e.NEAR="u_near",e.FAR="u_far",e.CAMERA_POS="u_cameraPos"}(P||(P={}));var O=new n(M,i(M,g,M.VERTEX_SHADER),i(M,"#version 300 es\n\nprecision highp float;\n\nin vec2 v_uv;\n\nout vec4 o_color;\n\nuniform sampler2D u_depthTexture;\nuniform mat4 u_invVpMatrix;\nuniform float u_near;\nuniform float u_far;\nuniform vec3 u_cameraPos;\n\nvec3 lightDir = normalize(vec3(1.0));\n\nfloat toLinearDepth(float depth, float near, float far) {\n    float nz = near * depth;\n    return -nz / (far * (depth - 1.0) - nz);\n}\n\nfloat toViewZ(float depth, float near, float far) {\n    return near + (far - near) * toLinearDepth(depth, near, far);\n}\n\nvec3 uvToWorldPos(ivec2 coord) {\n  ivec2 texSize = textureSize(u_depthTexture, 0);\n  float depth = clamp(texelFetch(u_depthTexture, coord, 0).r, 0.0, 1.0);\n  vec3 clipPos = vec3(vec2(coord) / vec2(texSize), depth) * 2.0 - 1.0;\n  return (u_invVpMatrix * vec4(clipPos, 1.0)).xyz;\n}\n\nvoid main(void) {\n  float depth = texture(u_depthTexture, v_uv).r;\n\n  float linearDepth = toLinearDepth(depth, u_near, u_far);\n\n  if (linearDepth > 0.99) {\n    o_color = vec4(1.0, 0.4, 0.5, 1.0);\n    return;\n  }\n\n  ivec2 coord = ivec2(gl_FragCoord.xy);\n  vec3 worldPos = uvToWorldPos(coord);\n  vec3 right = uvToWorldPos(coord + ivec2(1, 0));\n  vec3 left = uvToWorldPos(coord + ivec2(-1, 0));\n  vec3 up = uvToWorldPos(coord + ivec2(0, 1));\n  vec3 down = uvToWorldPos(coord + ivec2(0, -1));\n\n  vec3 ddx = right - left;\n  vec3 ddy = up - down;\n\n  vec3 worldNormal = normalize(cross(ddx, ddy));\n\n  vec3 refDir = reflect(-normalize(u_cameraPos - worldPos), worldNormal);\n\n  vec3 diffuse = vec3(0.1, 0.75, 0.65) * clamp(dot(lightDir, worldNormal) * 0.5 + 0.5, 0.0, 1.0);\n  vec3 spec = vec3(1.0, 0.4, 0.2) * pow(clamp(dot(lightDir, refDir), 0.0, 1.0), 4.0);\n\n  o_color = vec4(0.1 + diffuse + spec, 1.0);\n}",M.FRAGMENT_SHADER),Object.values(P)),U=new R(M,F.width,F.height),N=.001*performance.now(),B=N,V=null,C=function(){var e=.001*performance.now(),t=Math.min(.1,e-B),r=e-N;I.update(M,t,r),M.bindFramebuffer(M.FRAMEBUFFER,S.framebuffer),M.viewport(0,0,S.width,S.height),M.enable(M.DEPTH_TEST),M.clear(M.COLOR_BUFFER_BIT|M.DEPTH_BUFFER_BIT),I.render(M,D),M.disable(M.DEPTH_TEST);var n=new w(S.depthTexture,S.width,S.height),i=U.apply(M,n,.1,200,2.5,{gBuffer:S,camera:D});M.bindFramebuffer(M.FRAMEBUFFER,null),M.viewport(0,0,F.width,F.height),M.useProgram(O.program),u(M,0,i,O.getUniform(P.DEPTH_TEXTURE)),M.uniformMatrix4fv(O.getUniform(P.INV_VP_MATRIX),!1,D.vpMatrix.getInvMatrix().elements),M.uniform1f(O.getUniform(P.NEAR),.1),M.uniform1f(O.getUniform(P.FAR),200),M.uniform3fv(O.getUniform(P.CAMERA_POS),z.toArray()),M.drawArrays(M.TRIANGLES,0,6),B=e,V=requestAnimationFrame(C)};addEventListener("resize",(function(){null!==V&&(cancelAnimationFrame(V),V=null),F.width=innerWidth,F.height=innerHeight,D.aspect=F.width/F.height,S=new c(M,F.width,F.height),U=new R(M,F.width,F.height),V=requestAnimationFrame(C)})),V=requestAnimationFrame(C)}]);